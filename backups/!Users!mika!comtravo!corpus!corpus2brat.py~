import bz2
import json
import os


            

corpus = json.loads(bz2.open('corpus.bz2', 'r').read().decode('utf-8'))
for t in corpus:
    # with open(os.path.join('corpus', t['thread_id'] + '.ann'), 'w') as f:
    #     json.dump(t['annotation'], f)
    for m in t['messages']:
        with open(os.path.join('corpus', t['thread_id'] + '-' + m['id'] + '.txt'), 'w',
                  encoding='utf-8') as f:
            f.write(m['message']['body'].replace('\t', ' '))
        with open(os.path.join('corpus', t['thread_id'] + '-' + m['id'] + '.json'), 'w',
                  encoding='utf-8') as f:
            json.dump(m, f)
        with open(os.path.join('corpus', t['thread_id'] + '-' + m['id'] + '.ann'), 'w',
                  encoding='utf-8') as f:
            ann2brat(m['message'], m['annotation'], f)
        
        
