import logging
from . helpers import tag_wrapper, TagStatus
from event_model import apply_model
from event_model.postprocessing import get_flight_request

logger = logging.getLogger(__name__)


@tag_wrapper("events")
def tag_events(_, result):
    try:
        apply_model(None, result)
        fr = get_flight_request(result)
        if fr:
            result['requests'] = {'flight_requests': fr}
    except Exception as e:
        logger.exception(e)
        return TagStatus.server_error
    return TagStatus.success
