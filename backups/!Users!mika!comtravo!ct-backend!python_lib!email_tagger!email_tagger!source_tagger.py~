from . base_tagger import BaseTagger, TagStatus
from . helpers import _del_reply


class TypeTagger(BaseTagger):
    def tag(self, msg, result):
        """This does not yet do a lot. It assigns certain messages to a group
        'other' based on their subject:

        - other: payment confirmation messages
                 booking confirmation messages
                 check-in reminders
                 messages from comtravo bot
                 generally messages received from a comtravo email

        In all other cases the value is None
        """
        # Message label by subject
        subject = _del_reply(msg['subject'])
        msg_label = None
        if 'comtravo bot' in msg['from']['name'].lower():
            msg_label = 'other'
        elif msg['from']['email'].endswith('@comtravo.com'):
            msg_label = 'other'
        elif (subject.startswith("Successful payment for ") or
              subject.startswith("Neue Zahlung eingegangen von ") or
              subject.startswith("Payment from customer")):
            msg_label = "other"
        elif (subject.startswith("Received new email address") or
              subject.startswith("Folgende Booking-ID wurde nicht versendet") or
              ('mail-noreply@google.com' in msg['from']['email'])):
            msg_label = "other"
        elif (subject.startswith("Buchungsbestätigung") or
              subject.startswith("Ihre Buchungsbestätigung")):
            msg_label = "other"
        elif subject.startswith("Check-In Erinnerung"):
            msg_label = "other"
        result['label'] = msg_label
        return TagStatus.success
