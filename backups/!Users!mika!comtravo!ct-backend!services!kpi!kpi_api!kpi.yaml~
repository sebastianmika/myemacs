swagger: '2.0'

info:
  version: "0.0.1"
  title: KPI API
  description: Provides an grafana simple-json-datasource API to get some KPIs

basePath: /v1
schemes:
  - http

paths:
  /:
    get:
      description: say hello to test connections
      x-swagger-router-controller: kpi_api.controllers.index
      operationId: index
      responses:
        '200':
          description: Ok
          schema:
            $ref: '#/definitions/indexResponse'
        '401':
          $ref: '#/responses/Unauthorized'
        default:
          $ref: '#/responses/GeneralError'
  /search:
    post:
      description: get available data streams
      x-swagger-router-controller: kpi_api.controllers.search
      operationId: search
      parameters:
        - name: requestBody
          in: body
          description: query parameters
          schema:
            $ref: '#/definitions/targetElement'
      responses:
        '200':
          description: Ok
          schema:
            type: array
            items:
              type: string
        '401':
          $ref: '#/responses/Unauthorized'
        default:
          $ref: '#/responses/GeneralError'
  /query:
    post:
      description: get data stream
      x-swagger-router-controller: kpi_api.controllers.query
      operationId: query
      parameters:
        - name: requestBody
          in: body
          description: query parameters
          schema:
            $ref: '#/definitions/queryParameters'
      responses:
        '200':
          description: Ok
          schema:
            $ref: '#/definitions/queryResponse'
        '401':
          $ref: '#/responses/Unauthorized'
        default:
          $ref: '#/responses/GeneralError'

responses:
  Unauthorized:
    description: Unauthorized operation
    schema:
      $ref: '#/definitions/errorModel'
  GeneralError:
    description: Something went wrong
    schema:
      $ref: '#/definitions/errorModel'

definitions:
 
  errorModel:
    type: object
    required:
      - status
      - title
      - detail
    properties:
      status:
        type: integer
        format: int32
      title:
        type: string
      detail:
        type: string

  indexResponse:
    type: object
    required:
      - status
      - title
      - detail
    properties:
      status:
        type: integer
        format: int32
      title:
        type: string
      detail:
        type: string

  queryParameters:
    type: object
    properties:
      format:
        type: string
        enum: ["json"]
      maxDataPoints:
        type: integer
      panelId:
        type: integer
      rangeRaw:
        type: object
      targets:
        type: array
        items:
          $ref: '#/definitions/targetElement'
      interval:
        type: string
      range:
        type: object
        properties:
          from:
            type: string
            format: datetime
          to:
            type: string
            format: datetime
  
  targetElement:
    type: object
    properties:
      target:
        type: string
      refId: 
        type: string
    additionalProperties: false
        
  queryResponse:
    type: object
