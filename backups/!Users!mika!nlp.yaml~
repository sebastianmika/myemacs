swagger: '2.0'

info:
  version: "1.0.0"
  title: NLP API
  description: Provides simple Api to execute to parse relevant information from a message

basePath: /v1
schemes:
  - https

paths:
  /annotate:
    post:
      description: get annotations for an email message
      operationId: annotate
      parameters:
        - name: requestBody
          in: body
          description: message to annotate
          schema:
            $ref: '#/definitions/emailMessage'
      tags:
        - NLP
      responses:
        '200':
          description: Ok
          schema:
            $ref: '#/definitions/annotationResponse'
        '401':
          $ref: '#/responses/Unauthorized'

responses:
  Unauthorized:
    description: Unauthorized operation
    schema:
      $ref: '#/definitions/errorModel'

definitions:

  errorModel:
    required:
      - code
      - message
    properties:
      code:
        type: integer
        format: int32
      message:
        type: string

  emailMessage:
    description: e-mail message to annotate
    required:
      - body
      - subject
      - date
      - from
    properties:
      body:
        description: the actual message body
        type: string
      subject:
        description: the message subject
        type: string
      to:
        description: list of message recipients
        type: array
        items:
          $ref: '#/definitions/emailAddress'
        minLength: 1
      cc:
        description: list of cced message recipients
        type: array
        items:
          $ref: '#/definitions/emailAddress'
        minLength: 0
      from:
        $ref: '#/definitions/emailAddress'
      date:
        description: time of message receipt in miliseconds since the UTC epoch
        type: integer

  emailAddress:
    required:
      - email
    properties:
      email:
        type: string
        format: email
        description: the actual email adress
      name:
        type: string
        description: a string with a human readable name

  annotationResponse:
    properties:
      language:
        type: string
        minLength: 2
        maxLength: 2
        description: two letter language code, currently only 'de' and 'en'
      requestType:
        type: string
        enum: ['booking', 'cancellation', 'rebooking', 'negotiation', 'other']
        description: type of request in the message
      annotations:
        type: array
        items:
          $ref: '#/definitions/baseAnnotation'
        description: array of annotations
        
  baseAnnotation:
    description: base model for annotations
    required:
      - id
      - tag
      - discriminator
    properties:
      id:
        description: a unique id for this annotation
        type: string
        format: uuid
      tag:
        $ref: '#/definitions/tag'
      discriminator:
        description: discriptor for poor man's polymorphism
        type: string
        enum: ["personAnnotation", "locationAnnotation"]
  
  personAnnotation:
    description: a person
    allOf:
      - $ref: '#/definitions/baseAnnotation'
      - type: object
        properties:
          crm_ids:
            description: list of ids of persons in the crm
            type: array
            items:
              description: id of a person in the crm
              type: string
              
  tag:
    description: description of a part of text in a message
    required:
      - spans
      - text
      - where
    properties:
      spans:
        description: array of text spans for this tag
        type: array
        items:
          $ref: '#/definitions/span'
      text:
        description: the tagged bit of text, newlines replaced by space, tabs by space
        type: string
      where:
        description: part of the message this tag refers to
        type: string
        enum: ['body', 'subject']

  span:
    required:
      - start
      - end
    properties:
      start:
        description: start of text span
        type: integer
      end:
        description: end of text span
        type: integer
